## Codebase Patterns
- Shiny app source files are in `peskas.timor.portal/R/`
- Color palettes defined in `app_server.R` (habitatPalette, tabPalette, donutBlue, spiderColors)
- App uses ApexCharts for charts, DeckGL for hexagon map, Leaflet for 2D maps
- Data files stored in `public/data/*.json` (converted from R RDA files)
- All text uses i18n from `pars.json` with keys like `pars.header.nav.home.text`
- Map center coordinates: lat `-8.75`, lng `125.7`, zoom `8`

---

## 2026-01-14 - US-001
Thread: https://ampcode.com/threads/T-019bbc20-ce8f-7258-8273-5e038c2b797a
- Verified shiny-analysis.md already exists with comprehensive documentation
- Confirmed all acceptance criteria met:
  - Complete list of all Shiny tabs and modules (7 tabs)
  - Chart types documented (ApexCharts, DeckGL, Leaflet)
  - Color palettes extracted (6 palettes with hex values)
  - Mapping document created at scripts/ralph/shiny-analysis.md
- No files changed (document already existed from previous iteration)
- **Learnings for future iterations:**
  - Always check if work was already completed before starting
  - The shiny-analysis.md is the central reference for Shinyâ†’React mapping
  - React component structure proposal is in shiny-analysis.md
---

## 2026-01-14 - US-002a, US-002b, US-002c, US-002d (Batch Update)
Thread: https://ampcode.com/threads/T-019bbc25-e1dd-72c6-95b2-b47ba04cd08d
- Verified all 4 stories already complete from previous iterations
- US-002a: TypeScript interfaces for core data files in src/types/data.ts
- US-002b: All 9 remaining data file interfaces in src/types/data.ts
- US-002c: Data loading utilities (dataLoader.ts) and useData hook
- US-002d: DataTest component + data-mapping.md documentation
- Updated PRD to mark all as passes: true
- **Learnings for future iterations:**
  - Check existing code before implementing - types/hooks/utilities may already exist
  - The types file is comprehensive and covers all public/data/*.json files
---

## 2026-01-14 - Batch Status Update (39 stories marked complete)
Thread: https://ampcode.com/threads/T-019bbc25-e1dd-72c6-95b2-b47ba04cd08d
- Audited all stories against existing codebase
- Found 39 of 51 stories already implemented from previous iterations
- Updated PRD to mark all completed stories as passes: true
- Remaining 12 stories need work:
  - US-004b4: Treemap colors/interactions
  - US-004c1-c2: Composition page filters
  - US-010a: Conservation region visualizations
  - US-011b1-b3: Connect pages to global filters
  - US-012a1: Color palettes documentation
  - US-012a3: Audit chart colors
  - US-012b: Spacing consistency
  - US-013a: i18n text keys
  - US-014a: Final visual QA
- **Learnings for future iterations:**
  - Many stories were completed but not marked in PRD
  - Always verify code exists before starting implementation
  - The codebase is quite advanced with most core features done
---

## 2026-01-14 - US-004b4, US-004c1
Thread: https://ampcode.com/threads/T-019bbc25-e1dd-72c6-95b2-b47ba04cd08d
- US-004b4: Verified treemap already uses habitatPalette colors with hover interactions
  - ApexCharts treemap provides built-in hover/tooltip functionality
  - Colors correctly applied via habitatPalette constant
- US-004c1: Added MunicipalityFilter to Composition page
  - Imported MunicipalityFilter component and useFilters context
  - Added filter dropdown in page header
  - Year filter already existed from previous iteration
- Files changed: src/pages/Composition.tsx
- **Learnings for future iterations:**
  - ApexCharts provides built-in interactions, no custom implementation needed
  - Pages should use FilterContext from src/context/FilterContext.tsx for global filters
---
